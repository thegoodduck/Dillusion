import sys
import os
import base64
try:
    from PyQt5.QtWidgets import QApplication, QWizard, QWizardPage, QVBoxLayout, QLabel, QLineEdit, QCheckBox, QGroupBox, QRadioButton, QPushButton
    from PyQt5.QtCore import Qt
except ImportError:
    import subprocess
    subprocess.check_call([sys.executable, "-m", "pip", "install", "PyQt5", "--break-system-packages"])

import shutil
# Base64-encoded contents of main.py
MAIN_PY = b'IyEvdXNyL2Jpbi9weXRob24zCiMgSW1wb3J0aW5nIHJlcXVpcmVkIGxpYnJhcmllcwppbXBvcnQgc3lzCmltcG9ydCB0a2ludGVyIGFzIHRrCmltcG9ydCBzdWJwcm9jZXNzCmltcG9ydCBqc29uCmltcG9ydCB0aW1lCmltcG9ydCByZXF1ZXN0cwppbXBvcnQgc29ja2V0CmZyb20gUHlRdDUuUXRDb3JlIGltcG9ydCAqCmZyb20gUHlRdDUuUXRXaWRnZXRzIGltcG9ydCAqCmZyb20gUHlRdDUuUXRHdWkgaW1wb3J0ICoKZnJvbSBQeVF0NS5RdFdlYkVuZ2luZVdpZGdldHMgaW1wb3J0ICoKZnJvbSBQeVF0NS5RdFdlYkVuZ2luZUNvcmUgaW1wb3J0IFFXZWJFbmdpbmVVcmxSZXF1ZXN0SW50ZXJjZXB0b3IKZnJvbSBQeVF0NS5RdE5ldHdvcmsgaW1wb3J0IFFOZXR3b3JrUHJveHkKCiMgTG9hZCBhZCBzZWxlY3RvcnMgZnJvbSBmaWxlCnRyeToKICAgIHdpdGggb3BlbigiYWRfc2VsZWN0b3JzLmpzb24iLCAiciIpIGFzIGZpbGU6CiAgICAgICAgYWRfc2VsZWN0b3JzID0ganNvbi5sb2FkKGZpbGUpCmV4Y2VwdDoKICAgIHByaW50KCJbV0FSTl0gQ291bGQgbm90IGxvYWQgYWQgc2VsZWN0b3JzIikKICAgIGFkX3NlbGVjdG9ycyA9IFtdCgpjbGFzcyBMb2FkaW5nUHJvZ3Jlc3NCYXIoUVByb2dyZXNzQmFyKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCAqYXJncywgKiprd2FyZ3MpOgogICAgICAgIHN1cGVyKExvYWRpbmdQcm9ncmVzc0Jhciwgc2VsZikuX19pbml0X18oKmFyZ3MsICoqa3dhcmdzKQogICAgICAgIHNlbGYuc2V0U3R5bGVTaGVldCgiIiIKICAgICAgICAgICAgUVByb2dyZXNzQmFyIHsKICAgICAgICAgICAgICAgIGJvcmRlcjogMnB4IHNvbGlkIGdyZXk7CiAgICAgICAgICAgICAgICBib3JkZXItcmFkaXVzOiA1cHg7CiAgICAgICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgUVByb2dyZXNzQmFyOjpjaHVuayB7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMUU5MEZGOyAvKiBCbHVlIGNvbG9yICovCiAgICAgICAgICAgICAgICB3aWR0aDogMTBweDsKICAgICAgICAgICAgfQogICAgICAgICIiIikKICAgICAgICBzZWxmLnNldE1heGltdW0oMTAwKQogICAgICAgIHNlbGYuc2V0VmFsdWUoMCkKICAgICAgICBzZWxmLnNldEZvcm1hdCgiJXYlIikgICMgRGlzcGxheSB0aGUgcHJvZ3Jlc3MgdmFsdWUKICAgICAgICBzZWxmLnNldEFsaWdubWVudChRdC5BbGlnbkNlbnRlcikKICAgIGRlZiBzZXRfZG93bmxvYWRfc3BlZWQoc2VsZiwgc3BlZWQpOgogICAgICAgIHNlbGYuc2V0Rm9ybWF0KGYie3NlbGYudmFsdWUoKX0lIC0ge3NwZWVkfSBNYnBzIikKCmNsYXNzIEFkYmxvY2tlcihRV2ViRW5naW5lVXJsUmVxdWVzdEludGVyY2VwdG9yKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCAqYXJncywgKiprd2FyZ3MpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKmFyZ3MsICoqa3dhcmdzKQogICAgICAgIHNlbGYubG9hZF9ibG9ja2VkX2RvbWFpbnMoKQogICAgICAgIHNlbGYuYmxvY2tlZF9hZF9jb3VudCA9IDAKCiAgICAjIExvYWQgYmxvY2tlZCBkb21haW5zIGZyb20gZmlsZQogICAgZGVmIGxvYWRfYmxvY2tlZF9kb21haW5zKHNlbGYpOgogICAgICAgIHdpdGggb3BlbigiYmxvY2tlZF9kb21haW5zLmpzb24iLCAiciIpIGFzIGZpbGU6CiAgICAgICAgICAgIHNlbGYuYmxvY2tlZF9kb21haW5zID0ganNvbi5sb2FkKGZpbGUpCgogICAgIyBJbnRlcmNlcHQgcmVxdWVzdCBhbmQgYmxvY2sgYWRzCiAgICBkZWYgaW50ZXJjZXB0UmVxdWVzdChzZWxmLCBpbmZvKToKICAgICAgICB1cmwgPSBpbmZvLnJlcXVlc3RVcmwoKS50b1N0cmluZygpCiAgICAgICAgZm9yIGRvbWFpbiBpbiBzZWxmLmJsb2NrZWRfZG9tYWluczoKICAgICAgICAgICAgaWYgZG9tYWluIGluIHVybDoKICAgICAgICAgICAgICAgIGluZm8uYmxvY2soVHJ1ZSkKICAgICAgICAgICAgICAgIHNlbGYuYmxvY2tlZF9hZF9jb3VudCArPSAxCiAgICAgICAgICAgICAgICBwcmludChmIltERUJVR10gQmxvY2tlZCBhZCByZXF1ZXN0OiB7dXJsfSIpCiAgICAgICAgICAgICAgICBicmVhawoKICAgIGRlZiBnZXRfYmxvY2tlZF9hZF9jb3VudChzZWxmKToKICAgICAgICByZXR1cm4gc2VsZi5ibG9ja2VkX2FkX2NvdW50CgojIE1ldGhvZCB0byBoaWRlIGFkIGVsZW1lbnRzCmRlZiBoaWRlX2FkX2VsZW1lbnRzKHNlbGYpOgogICAganNfZnVuY3Rpb24gPSAiIiIKICAgICAgICBmdW5jdGlvbiBoaWRlQWRFbGVtZW50cyhzZWxlY3RvcnMpIHsKICAgICAgICAgICAgc2VsZWN0b3JzLmZvckVhY2goZnVuY3Rpb24oc2VsZWN0b3IpIHsKICAgICAgICAgICAgICAgIHZhciBlbGVtZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpOwogICAgICAgICAgICAgICAgZWxlbWVudHMuZm9yRWFjaChmdW5jdGlvbihlbGVtZW50KSB7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBoaWRlQWRFbGVtZW50cyglcyk7CiAgICAiIiIgJSBqc29uLmR1bXBzKGFkX3NlbGVjdG9ycykKICAgIHNlbGYudGFicy5jdXJyZW50V2lkZ2V0KCkucGFnZSgpLnJ1bkphdmFTY3JpcHQoanNfZnVuY3Rpb24sIGxhbWJkYSBfOiBOb25lKQogICAgcHJpbnQoIltERUJVR10gQWQgZWxlbWVudHMgaGlkZGVuIikKCmNsYXNzIE1haW5XaW5kb3coUU1haW5XaW5kb3cpOgogICAgIyBDb25zdHJ1Y3RvcgogICAgZGVmIF9faW5pdF9fKHNlbGYsICphcmdzLCAqKmt3YXJncyk6CiAgICAgICAgc3VwZXIoTWFpbldpbmRvdywgc2VsZikuX19pbml0X18oKmFyZ3MsICoqa3dhcmdzKQogICAgICAgIHNlbGYuYWRibG9ja2VyID0gQWRibG9ja2VyKCkKICAgICAgICBzZWxmLnBhZ2UgPSBRV2ViRW5naW5lUGFnZSgpCiAgICAgICAgc2VsZi5wYWdlLnByb2ZpbGUoKS5zZXRSZXF1ZXN0SW50ZXJjZXB0b3Ioc2VsZi5hZGJsb2NrZXIpCiAgICAgICAgcHJpbnQoIltERUJVR10gSW5pdGlhbGl6aW5nIG1haW4gd2luZG93IikKCiAgICAgICAgIyBTZXQgd2luZG93IHByb3BlcnRpZXMKICAgICAgICBzZWxmLnNldFdpbmRvd1RpdGxlKCJEaWxsdXNpb24gQnJvd3NlciIpCiAgICAgICAgc2VsZi5zZXRHZW9tZXRyeSgxMDAsIDEwMCwgMTIwMCwgODAwKQoKICAgICAgICAjIENyZWF0ZSBhIGNlbnRyYWwgd2lkZ2V0CiAgICAgICAgc2VsZi5jZW50cmFsX3dpZGdldCA9IFFXaWRnZXQoKQogICAgICAgIHNlbGYuc2V0Q2VudHJhbFdpZGdldChzZWxmLmNlbnRyYWxfd2lkZ2V0KQoKICAgICAgICAjIENyZWF0ZSBhIHZlcnRpY2FsIGxheW91dAogICAgICAgIHNlbGYubGF5b3V0ID0gUVZCb3hMYXlvdXQoc2VsZi5jZW50cmFsX3dpZGdldCkKICAgICAgICBzZWxmLmxheW91dC5zZXRDb250ZW50c01hcmdpbnMoMCwgMCwgMCwgMCkKCiAgICAgICAgIyBDcmVhdGluZyBhIGxvYWRpbmcgcHJvZ3Jlc3MgYmFyCiAgICAgICAgc2VsZi5sb2FkaW5nX3Byb2dyZXNzX2JhciA9IExvYWRpbmdQcm9ncmVzc0JhcihzZWxmKQogICAgICAgIHNlbGYubGF5b3V0LmFkZFdpZGdldChzZWxmLmxvYWRpbmdfcHJvZ3Jlc3NfYmFyKQoKICAgICAgICAjIENyZWF0aW5nIGEgdGFiIHdpZGdldAogICAgICAgIHNlbGYudGFicyA9IFFUYWJXaWRnZXQoKQogICAgICAgIHNlbGYudGFicy5zZXREb2N1bWVudE1vZGUoVHJ1ZSkKICAgICAgICBzZWxmLnRhYnMudGFiQmFyRG91YmxlQ2xpY2tlZC5jb25uZWN0KHNlbGYudGFiX29wZW5fZG91YmxlY2xpY2spCiAgICAgICAgc2VsZi50YWJzLmN1cnJlbnRDaGFuZ2VkLmNvbm5lY3Qoc2VsZi5jdXJyZW50X3RhYl9jaGFuZ2VkKQogICAgICAgIHNlbGYudGFicy5zZXRUYWJzQ2xvc2FibGUoVHJ1ZSkKICAgICAgICBzZWxmLnRhYnMudGFiQ2xvc2VSZXF1ZXN0ZWQuY29ubmVjdChzZWxmLmNsb3NlX2N1cnJlbnRfdGFiKQogICAgICAgIHNlbGYubGF5b3V0LmFkZFdpZGdldChzZWxmLnRhYnMpCgogICAgICAgICMgQ3JlYXRpbmcgYSBzdGF0dXMgYmFyCiAgICAgICAgc2VsZi5zdGF0dXMgPSBRU3RhdHVzQmFyKCkKICAgICAgICBzZWxmLnNldFN0YXR1c0JhcihzZWxmLnN0YXR1cykKCiAgICAgICAgIyBDcmVhdGluZyBhIHRvb2wgYmFyIGZvciBuYXZpZ2F0aW9uCiAgICAgICAgbmF2dGIgPSBRVG9vbEJhcigiTmF2aWdhdGlvbiIpCiAgICAgICAgbmF2dGIuc2V0SWNvblNpemUoUVNpemUoMjQsIDI0KSkgICMgU2V0IGljb24gc2l6ZSBmb3IgYSBtb2Rlcm4gbG9vawogICAgICAgIHNlbGYuYWRkVG9vbEJhcihRdC5Ub3BUb29sQmFyQXJlYSwgbmF2dGIpCgogICAgICAgICMgQ3JlYXRpbmcgbmF2aWdhdGlvbiBidXR0b25zIHdpdGggZW1vamlzCiAgICAgICAgYmFja19idG4gPSBRQWN0aW9uKCLirIXvuI8iLCBzZWxmKQogICAgICAgIGJhY2tfYnRuLnNldFN0YXR1c1RpcCgiQmFjayB0byBwcmV2aW91cyBwYWdlIikKICAgICAgICBiYWNrX2J0bi50cmlnZ2VyZWQuY29ubmVjdChsYW1iZGE6IHNlbGYudGFicy5jdXJyZW50V2lkZ2V0KCkuYmFjaygpKQogICAgICAgIG5hdnRiLmFkZEFjdGlvbihiYWNrX2J0bikKCiAgICAgICAgbmV4dF9idG4gPSBRQWN0aW9uKCLinqHvuI8iLCBzZWxmKQogICAgICAgIG5leHRfYnRuLnNldFN0YXR1c1RpcCgiRm9yd2FyZCB0byBuZXh0IHBhZ2UiKQogICAgICAgIG5leHRfYnRuLnRyaWdnZXJlZC5jb25uZWN0KGxhbWJkYTogc2VsZi50YWJzLmN1cnJlbnRXaWRnZXQoKS5mb3J3YXJkKCkpCiAgICAgICAgbmF2dGIuYWRkQWN0aW9uKG5leHRfYnRuKQoKICAgICAgICByZWxvYWRfYnRuID0gUUFjdGlvbigi8J+UhCIsIHNlbGYpCiAgICAgICAgcmVsb2FkX2J0bi5zZXRTdGF0dXNUaXAoIlJlbG9hZCBwYWdlIikKICAgICAgICByZWxvYWRfYnRuLnRyaWdnZXJlZC5jb25uZWN0KGxhbWJkYTogc2VsZi50YWJzLmN1cnJlbnRXaWRnZXQoKS5yZWxvYWQoKSkKICAgICAgICBuYXZ0Yi5hZGRBY3Rpb24ocmVsb2FkX2J0bikKCiAgICAgICAgaG9tZV9idG4gPSBRQWN0aW9uKCLwn4+gIiwgc2VsZikKICAgICAgICBob21lX2J0bi5zZXRTdGF0dXNUaXAoIkdvIGhvbWUiKQogICAgICAgIGhvbWVfYnRuLnRyaWdnZXJlZC5jb25uZWN0KHNlbGYubmF2aWdhdGVfaG9tZSkKICAgICAgICBuYXZ0Yi5hZGRBY3Rpb24oaG9tZV9idG4pCgogICAgICAgIG5hdnRiLmFkZFNlcGFyYXRvcigpCgogICAgICAgIHNlbGYudXJsYmFyID0gUUxpbmVFZGl0KCkKICAgICAgICBzZWxmLnVybGJhci5zZXRNYXhpbXVtSGVpZ2h0KDMwKSAgIyBTZXQgaGVpZ2h0IGZvciB0aGUgVVJMIGJhcgogICAgICAgIHNlbGYudXJsYmFyLnJldHVyblByZXNzZWQuY29ubmVjdChzZWxmLm5hdmlnYXRlX3RvX3VybCkKICAgICAgICBuYXZ0Yi5hZGRXaWRnZXQoc2VsZi51cmxiYXIpCgogICAgICAgIHN0b3BfYnRuID0gUUFjdGlvbigi8J+bkSIsIHNlbGYpCiAgICAgICAgc3RvcF9idG4uc2V0U3RhdHVzVGlwKCJTdG9wIGxvYWRpbmcgY3VycmVudCBwYWdlIikKICAgICAgICBzdG9wX2J0bi50cmlnZ2VyZWQuY29ubmVjdChsYW1iZGE6IHNlbGYudGFicy5jdXJyZW50V2lkZ2V0KCkuc3RvcCgpKQogICAgICAgIG5hdnRiLmFkZEFjdGlvbihzdG9wX2J0bikKCiAgICAgICAgc2VsZi5wcml2YWN5X2J0biA9IFFBY3Rpb24oIvCflbXvuI8iLCBzZWxmKQogICAgICAgIHNlbGYucHJpdmFjeV9idG4uc2V0Q2hlY2thYmxlKFRydWUpCiAgICAgICAgc2VsZi5wcml2YWN5X2J0bi5zZXRTdGF0dXNUaXAoIlRvZ2dsZSBQcml2YWN5IE1vZGUiKQogICAgICAgIHNlbGYucHJpdmFjeV9idG4udHJpZ2dlcmVkLmNvbm5lY3Qoc2VsZi50b2dnbGVfcHJpdmFjeV9tb2RlKQogICAgICAgIG5hdnRiLmFkZEFjdGlvbihzZWxmLnByaXZhY3lfYnRuKQoKICAgICAgICBzZWxmLnRvcl9idG4gPSBRQWN0aW9uKCLwn6eFIiwgc2VsZikKICAgICAgICBzZWxmLnRvcl9idG4uc2V0Q2hlY2thYmxlKFRydWUpCiAgICAgICAgc2VsZi50b3JfYnRuLnNldFN0YXR1c1RpcCgiVG9nZ2xlIFRvciBNb2RlIikKICAgICAgICBzZWxmLnRvcl9idG4udHJpZ2dlcmVkLmNvbm5lY3Qoc2VsZi50b2dnbGVfdG9yX21vZGUpCiAgICAgICAgbmF2dGIuYWRkQWN0aW9uKHNlbGYudG9yX2J0bikKCiAgICAgICAgY2xlYXJfY29va2llc19idG4gPSBRQWN0aW9uKCLwn6e5Iiwgc2VsZikKICAgICAgICBjbGVhcl9jb29raWVzX2J0bi5zZXRTdGF0dXNUaXAoIkNsZWFyIGFsbCBjb29raWVzIikKICAgICAgICBjbGVhcl9jb29raWVzX2J0bi50cmlnZ2VyZWQuY29ubmVjdChzZWxmLmNsZWFyX2Nvb2tpZXMpCiAgICAgICAgbmF2dGIuYWRkQWN0aW9uKGNsZWFyX2Nvb2tpZXNfYnRuKQoKICAgICAgICBuZXdfdGFiX2J0biA9IFFBY3Rpb24oIvCfhpUiLCBzZWxmKQogICAgICAgIG5ld190YWJfYnRuLnNldFN0YXR1c1RpcCgnT3BlbiBhIG5ldyB0YWInKQogICAgICAgIG5ld190YWJfYnRuLnRyaWdnZXJlZC5jb25uZWN0KGxhbWJkYTogc2VsZi5hZGRfbmV3X3RhYihRVXJsKCdodHRwOi8vd3d3Lmdvb2dsZS5jb20nKSwgJ05ldyBUYWInKSkKICAgICAgICBuYXZ0Yi5hZGRBY3Rpb24obmV3X3RhYl9idG4pCgogICAgICAgIGFkX2NvdW50X2J0biA9IFFBY3Rpb24oIvCfk4oiLCBzZWxmKQogICAgICAgIGFkX2NvdW50X2J0bi5zZXRTdGF0dXNUaXAoJ1Nob3cgYmxvY2tlZCBhZCBjb3VudCcpCiAgICAgICAgYWRfY291bnRfYnRuLnRyaWdnZXJlZC5jb25uZWN0KHNlbGYuc2hvd19ibG9ja2VkX2FkX2NvdW50KQogICAgICAgIG5hdnRiLmFkZEFjdGlvbihhZF9jb3VudF9idG4pCgogICAgICAgIHNlbGYuYWRkX25ld190YWIoUVVybCgnaHR0cDovL3d3dy5nb29nbGUuY29tJyksICdIb21lcGFnZScpCgogICAgICAgIHNlbGYuaXNfcHJpdmFjeV9tb2RlID0gRmFsc2UKICAgICAgICBzZWxmLmlzX3Rvcl9tb2RlID0gRmFsc2UKICAgICAgICBzZWxmLnRvcl9wcm9maWxlID0gTm9uZQoKICAgICAgICAjIEFwcGx5IGN1c3RvbSBzdHlsZXNoZWV0CiAgICAgICAgc2VsZi5hcHBseV9zdHlsZXMoKQoKICAgICAgICAjIFNob3cgdGhlIHdpbmRvdwogICAgICAgIHNlbGYuc2hvdygpCgogICAgIyBNZXRob2QgZm9yIGFkZGluZyBuZXcgdGFiCiAgICBkZWYgYWRkX25ld190YWIoc2VsZiwgcXVybD1Ob25lLCBsYWJlbD0iQmxhbmsiLCBwcm9maWxlPU5vbmUpOgogICAgICAgIGlmIHF1cmwgaXMgTm9uZToKICAgICAgICAgICAgcXVybCA9IFFVcmwoJ2h0dHA6Ly93d3cuZ29vZ2xlLmNvbScpCgogICAgICAgIGlmIHByb2ZpbGUgaXMgTm9uZToKICAgICAgICAgICAgcHJvZmlsZSA9IFFXZWJFbmdpbmVQcm9maWxlLmRlZmF1bHRQcm9maWxlKCkKCiAgICAgICAgYnJvd3NlciA9IFFXZWJFbmdpbmVWaWV3KCkKICAgICAgICBwYWdlID0gUVdlYkVuZ2luZVBhZ2UocHJvZmlsZSwgYnJvd3NlcikKICAgICAgICBicm93c2VyLnNldFBhZ2UocGFnZSkKICAgICAgICBicm93c2VyLnNldFVybChxdXJsKQoKICAgICAgICBpID0gc2VsZi50YWJzLmFkZFRhYihicm93c2VyLCBsYWJlbCkKICAgICAgICBzZWxmLnRhYnMuc2V0Q3VycmVudEluZGV4KGkpCgogICAgICAgIGJyb3dzZXIudXJsQ2hhbmdlZC5jb25uZWN0KGxhbWJkYSBxdXJsLCBicm93c2VyPWJyb3dzZXI6IHNlbGYudXBkYXRlX3VybGJhcihxdXJsLCBicm93c2VyKSkKICAgICAgICBicm93c2VyLmxvYWRGaW5pc2hlZC5jb25uZWN0KGxhbWJkYSBfLCBpPWksIGJyb3dzZXI9YnJvd3Nlcjogc2VsZi50YWJzLnNldFRhYlRleHQoaSwgYnJvd3Nlci5wYWdlKCkudGl0bGUoKSkpCiAgICAgICAgYnJvd3Nlci5sb2FkRmluaXNoZWQuY29ubmVjdChsYW1iZGE6IGhpZGVfYWRfZWxlbWVudHMoc2VsZikpCiAgICAgICAgYnJvd3Nlci5sb2FkUHJvZ3Jlc3MuY29ubmVjdChzZWxmLnVwZGF0ZV9sb2FkaW5nX3Byb2dyZXNzKQogICAgICAgIGJyb3dzZXIubG9hZEZpbmlzaGVkLmNvbm5lY3QobGFtYmRhOiBzZWxmLmxvYWRpbmdfcHJvZ3Jlc3NfYmFyLnNldFZhbHVlKDApKQoKICAgICAgICBwcmludChmIltERUJVR10gTmV3IHRhYiBhZGRlZCB3aXRoIFVSTDoge3F1cmwudG9TdHJpbmcoKX0iKQoKICAgICMgV2hlbiBkb3VibGUgY2xpY2tlZCBpcyBwcmVzc2VkIG9uIHRhYnMKICAgIGRlZiB0YWJfb3Blbl9kb3VibGVjbGljayhzZWxmLCBpKToKICAgICAgICBpZiBpID09IC0xOgogICAgICAgICAgICBwcmludCgiW0RFQlVHXSBEb3VibGUtY2xpY2sgZGV0ZWN0ZWQgb24gdGFiIGJhciwgb3BlbmluZyBuZXcgdGFiIikKICAgICAgICAgICAgc2VsZi5hZGRfbmV3X3RhYihRVXJsKCdodHRwOi8vd3d3Lmdvb2dsZS5jb20nKSwgJ05ldyBUYWInKQoKICAgICMgV2hlbiB0YWIgaXMgY2hhbmdlZAogICAgZGVmIGN1cnJlbnRfdGFiX2NoYW5nZWQoc2VsZiwgaSk6CiAgICAgICAgaWYgc2VsZi50YWJzLmNvdW50KCkgPT0gMDoKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgY3VycmVudF93aWRnZXQgPSBzZWxmLnRhYnMuY3VycmVudFdpZGdldCgpCiAgICAgICAgaWYgY3VycmVudF93aWRnZXQgaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgcXVybCA9IGN1cnJlbnRfd2lkZ2V0LnVybCgpCiAgICAgICAgc2VsZi51cGRhdGVfdXJsYmFyKHF1cmwsIGN1cnJlbnRfd2lkZ2V0KQogICAgICAgIHNlbGYudXBkYXRlX3RpdGxlKGN1cnJlbnRfd2lkZ2V0KQoKICAgICAgICBwcmludChmIltERUJVR10gVGFiIGNoYW5nZWQgdG8gaW5kZXg6IHtpfSwgVVJMOiB7cXVybC50b1N0cmluZygpfSIpCgogICAgIyBDbG9zZSBjdXJyZW50IHRhYgogICAgZGVmIGNsb3NlX2N1cnJlbnRfdGFiKHNlbGYsIGkpOgogICAgICAgIGlmIHNlbGYudGFicy5jb3VudCgpIDwgMjoKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgc2VsZi50YWJzLnJlbW92ZVRhYihpKQogICAgICAgIHByaW50KGYiW0RFQlVHXSBUYWIgY2xvc2VkIGF0IGluZGV4OiB7aX0iKQoKICAgICMgVXBkYXRlIHdpbmRvdyB0aXRsZQogICAgZGVmIHVwZGF0ZV90aXRsZShzZWxmLCBicm93c2VyKToKICAgICAgICBpZiBicm93c2VyICE9IHNlbGYudGFicy5jdXJyZW50V2lkZ2V0KCk6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIHRpdGxlID0gc2VsZi50YWJzLmN1cnJlbnRXaWRnZXQoKS5wYWdlKCkudGl0bGUoKQogICAgICAgIHNlbGYuc2V0V2luZG93VGl0bGUoZiJ7dGl0bGV9IC0gRGlsbHVzaW9uIEJyb3dzZXIiKQoKICAgICMgTmF2aWdhdGUgdG8gaG9tZSBwYWdlCiAgICBkZWYgbmF2aWdhdGVfaG9tZShzZWxmKToKICAgICAgICBzZWxmLnRhYnMuY3VycmVudFdpZGdldCgpLnNldFVybChRVXJsKCJodHRwOi8vd3d3Lmdvb2dsZS5jb20iKSkKICAgICAgICBwcmludCgiW0RFQlVHXSBOYXZpZ2F0aW5nIHRvIGhvbWVwYWdlIikKCiAgICAjIE5hdmlnYXRlIHRvIFVSTAogICAgZGVmIG5hdmlnYXRlX3RvX3VybChzZWxmKToKICAgICAgICBxID0gUVVybChzZWxmLnVybGJhci50ZXh0KCkpCiAgICAgICAgaWYgcS5zY2hlbWUoKSA9PSAiIjoKICAgICAgICAgICAgcS5zZXRTY2hlbWUoImh0dHAiKQogICAgICAgIHNlbGYudGFicy5jdXJyZW50V2lkZ2V0KCkuc2V0VXJsKHEpCiAgICAgICAgcHJpbnQoZiJbREVCVUddIE5hdmlnYXRpbmcgdG8gVVJMOiB7cS50b1N0cmluZygpfSIpCgogICAgIyBVcGRhdGUgVVJMIGJhcgogICAgZGVmIHVwZGF0ZV91cmxiYXIoc2VsZiwgcSwgYnJvd3Nlcj1Ob25lKToKICAgICAgICBpZiBicm93c2VyICE9IHNlbGYudGFicy5jdXJyZW50V2lkZ2V0KCk6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIHNlbGYudXJsYmFyLnNldFRleHQocS50b1N0cmluZygpKQogICAgICAgIHNlbGYudXJsYmFyLnNldEN1cnNvclBvc2l0aW9uKDApCiAgICAgICAgcHJpbnQoZiJbREVCVUddIFVSTCBiYXIgdXBkYXRlZCB0bzoge3EudG9TdHJpbmcoKX0iKQoKICAgICMgQ2xlYXIgY29va2llcwogICAgZGVmIGNsZWFyX2Nvb2tpZXMoc2VsZik6CiAgICAgICAgcHJvZmlsZSA9IHNlbGYudGFicy5jdXJyZW50V2lkZ2V0KCkucGFnZSgpLnByb2ZpbGUoKQogICAgICAgIHByb2ZpbGUuY2xlYXJBbGxWaXNpdGVkTGlua3MoKQogICAgICAgIHByb2ZpbGUuY29va2llU3RvcmUoKS5kZWxldGVBbGxDb29raWVzKCkKICAgICAgICBwcmludCgiW0RFQlVHXSBDb29raWVzIGNsZWFyZWQiKQoKICAgICMgQXBwbHkgY3VzdG9tIHN0eWxlcwogICAgZGVmIGFwcGx5X3N0eWxlcyhzZWxmKToKICAgICAgICBzZWxmLnNldFN0eWxlU2hlZXQoIiIiCiAgICAgICAgICAgIFFNYWluV2luZG93IHsKICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNGNUY1RjU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgUVRvb2xCYXIgewogICAgICAgICAgICAgICAgYmFja2dyb3VuZDogI0ZGRkZGRjsKICAgICAgICAgICAgfQogICAgICAgICAgICBRVGFiV2lkZ2V0OjpwYW5lIHsKICAgICAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkIGxpZ2h0Z3JheTsKICAgICAgICAgICAgfQogICAgICAgICAgICBRVGFiQmFyOjp0YWI6c2VsZWN0ZWQgewogICAgICAgICAgICAgICAgYmFja2dyb3VuZDogIzFFOTBGRjsKICAgICAgICAgICAgICAgIGNvbG9yOiAjRkZGRkZGOwogICAgICAgICAgICB9CiAgICAgICAgICAgIFFUYWJCYXI6OnRhYiB7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAjRTVFNUU1OwogICAgICAgICAgICAgICAgcGFkZGluZzogMTBweDsKICAgICAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkIGxpZ2h0Z3JheTsKICAgICAgICAgICAgfQogICAgICAgICAgICBRTGluZUVkaXQgewogICAgICAgICAgICAgICAgcGFkZGluZzogNXB4OwogICAgICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgbGlnaHRncmF5OwogICAgICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNXB4OwogICAgICAgICAgICAgICAgZm9udC1zaXplOiAxNHB4OwogICAgICAgICAgICB9CiAgICAgICAgIiIiKQogICAgICAgIHByaW50KCJbREVCVUddIEN1c3RvbSBzdHlsZXMgYXBwbGllZCIpCgogICAgIyBUb2dnbGUgcHJpdmFjeSBtb2RlCiAgICBkZWYgdG9nZ2xlX3ByaXZhY3lfbW9kZShzZWxmKToKICAgICAgICBzZWxmLmlzX3ByaXZhY3lfbW9kZSA9IG5vdCBzZWxmLmlzX3ByaXZhY3lfbW9kZQogICAgICAgIGlmIHNlbGYuaXNfcHJpdmFjeV9tb2RlOgogICAgICAgICAgICBwcmludCgiW0RFQlVHXSBQcml2YWN5IG1vZGUgZW5hYmxlZCIpCiAgICAgICAgICAgICMgRW5hYmxlIHByaXZhY3kgZmVhdHVyZXMgaGVyZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KCJbREVCVUddIFByaXZhY3kgbW9kZSBkaXNhYmxlZCIpCiAgICAgICAgICAgICMgRGlzYWJsZSBwcml2YWN5IGZlYXR1cmVzIGhlcmUKCiAgICAjIFRvZ2dsZSBUb3IgbW9kZQogICAgZGVmIHRvZ2dsZV90b3JfbW9kZShzZWxmKToKICAgICAgICBzZWxmLmlzX3Rvcl9tb2RlID0gbm90IHNlbGYuaXNfdG9yX21vZGUKICAgICAgICBpZiBzZWxmLmlzX3Rvcl9tb2RlOgogICAgICAgICAgICBwcmludCgiW0RFQlVHXSBUb3IgbW9kZSBlbmFibGVkIikKICAgICAgICAgICAgc2VsZi50b3JfcHJvZmlsZSA9IFFXZWJFbmdpbmVQcm9maWxlKCJ0b3JfcHJvZmlsZSIsIHNlbGYpCiAgICAgICAgICAgIHByb3h5ID0gUU5ldHdvcmtQcm94eSgpCiAgICAgICAgICAgIHByb3h5LnNldFR5cGUoUU5ldHdvcmtQcm94eS5Tb2NrczVQcm94eSkKICAgICAgICAgICAgcHJveHkuc2V0SG9zdE5hbWUoImxvY2FsaG9zdCIpCiAgICAgICAgICAgIHByb3h5LnNldFBvcnQoOTA1MCkKICAgICAgICAgICAgc2VsZi50b3JfcHJvZmlsZS5zZXRSZXF1ZXN0SW50ZXJjZXB0b3Ioc2VsZi5hZGJsb2NrZXIpCiAgICAgICAgICAgIHNlbGYuYWRkX25ld190YWIocHJvZmlsZT1zZWxmLnRvcl9wcm9maWxlKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KCJbREVCVUddIFRvciBtb2RlIGRpc2FibGVkIikKICAgICAgICAgICAgc2VsZi50b3JfcHJvZmlsZSA9IE5vbmUKICAgICAgICAgICAgc2VsZi5hZGRfbmV3X3RhYigpCgogICAgIyBTaG93IGJsb2NrZWQgYWQgY291bnQKICAgIGRlZiBzaG93X2Jsb2NrZWRfYWRfY291bnQoc2VsZik6CiAgICAgICAgY291bnQgPSBzZWxmLmFkYmxvY2tlci5nZXRfYmxvY2tlZF9hZF9jb3VudCgpCiAgICAgICAgUU1lc3NhZ2VCb3guaW5mb3JtYXRpb24oc2VsZiwgIkJsb2NrZWQgQWRzIiwgZiJCbG9ja2VkIEFkIFJlcXVlc3RzOiB7Y291bnR9IikKICAgICAgICBwcmludChmIltERUJVR10gQmxvY2tlZCBhZCBjb3VudCBzaG93bjoge2NvdW50fSIpCgogICAgIyBVcGRhdGUgbG9hZGluZyBwcm9ncmVzcwogICAgZGVmIHVwZGF0ZV9sb2FkaW5nX3Byb2dyZXNzKHNlbGYsIHByb2dyZXNzKToKICAgICAgICBzZWxmLmxvYWRpbmdfcHJvZ3Jlc3NfYmFyLnNldFZhbHVlKHByb2dyZXNzKQogICAgICAgIHByaW50KGYiW0RFQlVHXSBMb2FkaW5nIHByb2dyZXNzOiB7cHJvZ3Jlc3N9JSIpCgogICAgIyBEZXRlY3QgaWYgdGhlIGNvbm5lY3Rpb24gaXMgSFRUUFMKICAgIGRlZiBpc19odHRwcyhzZWxmLCB1cmwpOgogICAgICAgIHJldHVybiB1cmwuc2NoZW1lKCkgPT0gJ2h0dHBzJwoKICAgICMgRW5hYmxlIGZpbGUgdXBsb2FkcyBhbmQgZG93bmxvYWRzCiAgICBkZWYgZW5hYmxlX2ZpbGVfdXBsb2Fkc19kb3dubG9hZHMoc2VsZik6CiAgICAgICAgc2VsZi5wYWdlLnByb2ZpbGUoKS5zZXRIdHRwQWNjZXB0UmVxdWVzdEhlYWRlcnMoWydhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nXSkKICAgICAgICBzZWxmLnBhZ2UucHJvZmlsZSgpLnNldEh0dHBBY2NlcHRSZXNwb25zZUhlYWRlcnMoWydhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nXSkKICAgICAgICBzZWxmLnBhZ2UuZG93bmxvYWRSZXF1ZXN0ZWQuY29ubmVjdChzZWxmLmRvd25sb2FkX2ZpbGUpCiAgICAgICAgc2VsZi5wYWdlLnVwbG9hZFJlcXVlc3RlZC5jb25uZWN0KHNlbGYudXBsb2FkX2ZpbGUpCiAgICAgICAgcHJpbnQoIltERUJVR10gRmlsZSB1cGxvYWRzIGFuZCBkb3dubG9hZHMgZW5hYmxlZCIpCgogICAgZGVmIGRvd25sb2FkX2ZpbGUoc2VsZiwgZG93bmxvYWQpOgogICAgICAgIGRvd25sb2FkLmFjY2VwdCgpCiAgICAgICAgcHJpbnQoZiJbREVCVUddIERvd25sb2FkaW5nIGZpbGU6IHtkb3dubG9hZC51cmwoKS50b1N0cmluZygpfSIpCgogICAgZGVmIHVwbG9hZF9maWxlKHNlbGYsIHVwbG9hZCk6CiAgICAgICAgZmlsZW5hbWUsIF8gPSBRRmlsZURpYWxvZy5nZXRPcGVuRmlsZU5hbWUoc2VsZiwgIlNlbGVjdCBmaWxlIHRvIHVwbG9hZCIpCiAgICAgICAgaWYgZmlsZW5hbWU6CiAgICAgICAgICAgIHVwbG9hZC5zZXRGaWxlKGZpbGVuYW1lKQogICAgICAgICAgICBwcmludChmIltERUJVR10gVXBsb2FkaW5nIGZpbGU6IHtmaWxlbmFtZX0iKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHVwbG9hZC5jYW5jZWwoKQoKIyBNYWluIGVudHJ5IHBvaW50CmFwcCA9IFFBcHBsaWNhdGlvbihzeXMuYXJndikKUUFwcGxpY2F0aW9uLnNldEFwcGxpY2F0aW9uTmFtZSgiRGlsbHVzaW9uIEJyb3dzZXIiKQptYWluX3dpbmRvdyA9IE1haW5XaW5kb3coKQphcHAuZXhlY18oKQo='

# Base64-encoded contents of ad_selectors.json
AD_SELECTORS_JSON = b'WyIuYWQtYmFubmVyIiwgIi5hZC1jb250YWluZXIiLCAiLmFkIl0='

# Base64-encoded contents of blocked_domains.json
BLOCKED_DOMAINS_JSON = b'WwogICAgImRvdWJsZWNsaWNrLm5ldCIsCiAgICAiZ29vZ2xlYWRzZXJ2aWNlcy5jb20iLAogICAgImFkdmVydGlzaW5nLmNvbSIsCiAgICAiYWRueHMuY29tIiwKICAgICJhZHNydnIub3JnIiwKICAgICJhZHRlY2h1cy5jb20iLAogICAgImFtYXpvbi1hZHN5c3RlbS5jb20iLAogICAgImJpZHN3aXRjaC5uZXQiLAogICAgImNhc2FsZW1lZGlhLmNvbSIsCiAgICAiY29udGV4dHdlYi5jb20iLAogICAgImNyaXRlby5jb20iLAogICAgImNyaXRlb2lzLmNvbSIsCiAgICAiZGVtZGV4Lm5ldCIsCiAgICAiZG91YmxlY2xpY2suY29tIiwKICAgICJleG9jbGljay5jb20iLAogICAgImV4b3Nydi5jb20iLAogICAgImV5ZWJsYXN0ZXIuY29tIiwKICAgICJleWVyZXR1cm4uY29tIiwKICAgICJleWV3b25kZXIuY29tIiwKICAgICJmYXN0Y2xpY2suY29tIiwKICAgICJmYXN0Y2xpY2submV0IiwKICAgICJmd21ybS5uZXQiLAogICAgImdvb2dsZXN5bmRpY2F0aW9uLmNvbSIsCiAgICAiaW52aXRlbWVkaWEuY29tIiwKICAgICJpcHJvbW90aXZlLmNvbSIsCiAgICAiaml2b3guY29tIiwKICAgICJsaWppdC5jb20iLAogICAgIm1lZGlhZm9yZ2UuY29tIiwKICAgICJtZWRpYXBsZXguY29tIiwKICAgICJtaWxsZW5uaWFsbWVkaWEuY29tIiwKICAgICJtb2F0YWRzLmNvbSIsCiAgICAibW9va2llMS5jb20iLAogICAgIm9wZW54LmNvbSIsCiAgICAib3BlbngubmV0IiwKICAgICJwdWJtYXRpYy5jb20iLAogICAgInB1bHNlcG9pbnQuY29tIiwKICAgICJyZWFsbWVkaWEuY29tIiwKICAgICJyZXZzY2kubmV0IiwKICAgICJybGNkbi5jb20iLAogICAgInJ1Ymljb25wcm9qZWN0LmNvbSIsCiAgICAic2NvcmVjYXJkcmVzZWFyY2guY29tIiwKICAgICJzZXJ2aW5nLXN5cy5jb20iLAogICAgInNoYXJldGhpcy5jb20iLAogICAgInNtYXJ0YWRzZXJ2ZXIuY29tIiwKICAgICJzdGFydGFwcC5jb20iLAogICAgInN0YXJ0YXBwc2VydmljZS5jb20iLAogICAgInRlYWRzLnR2IiwKICAgICJ0cmliYWxmdXNpb24uY29tIiwKICAgICJ0dXJuLmNvbSIsCiAgICAidW5kZXJkb2dtZWRpYS5jb20iLAogICAgInVuZGVydG9uZS5jb20iLAogICAgInZpZGlibGUudHYiLAogICAgInlpZWxkbWFuYWdlci5jb20iLAogICAgInlpZWxkbW8uY29tIiwKICAgICJ6ZWRvLmNvbSIsCiAgICAiMm83Lm5ldCIsCiAgICAiMzNhY3Jvc3MuY29tIiwKICAgICI0aW5mby5jb20iLAogICAgIjRtYWRzLmNvbSIsCiAgICAiNWRhdGEuaW5mbyIsCiAgICAiYTgubmV0IiwKICAgICJhYWRkenouY29tIiwKICAgICJhYXgtdXMtZWFzdC5hbWF6b24tYWRzeXN0ZW0uY29tIiwKICAgICJhYXgtdXMtd2VzdC5hbWF6b24tYWRzeXN0ZW0uY29tIiwKICAgICJhYmFjYXN0LmNvbSIsCiAgICAiYWJhY2FzdC5uZXQiLAogICAgImFidGFzdHkuY29tIiwKICAgICJhY2JhZGdlLmNvIiwKICAgICJhY2JhZGdlLmNvbSIsCiAgICAiYWNiYWRnZS5pbyIsCiAgICAiYWNiYWRnZS5uZXQiLAogICAgImFjYmFkZ2Uub3JnIiwKICAgICJhY2JhZGdlLnRlY2giLAogICAgImFjYmFkZ2UudG9wIiwKICAgICJhY2JhZGdlLnh5eiIsCiAgICAiYWNiYWRnZXAuY29tIiwKICAgICJhY2JhZGdlcC5uZXQiLAogICAgImFjYmFkZ2VwLm9yZyIsCiAgICAiYWNiYWRnZXAudGVjaCIsCiAgICAiYWNiYWRnZXAudG9wIiwKICAgICJhY2JhZGdlcC54eXoiLAogICAgImFjYmFkZ2V2LmNvbSIsCiAgICAiYWNiYWRnZXYubmV0IiwKICAgICJhY2JhZGdldi5vcmciLAogICAgImFjYmFkZ2V2LnRlY2giLAogICAgImFjYmFkZ2V2LnRvcCIsCiAgICAiYWNiYWRnZXYueHl6IiwKICAgICJhY2JhZGdleC5jb20iLAogICAgImFjYmFkZ2V4Lm5ldCIsCiAgICAiYWNiYWRnZXgub3JnIiwKICAgICJhY2JhZGdleC50ZWNoIiwKICAgICJhY2JhZGdleC50b3AiLAogICAgImFjYmFkZ2V4Lnh5eiIsCiAgICAiYWNiYWRnZXkuY29tIiwKICAgICJhY2JhZGdleS5uZXQiLAogICAgImFjYmFkZ2V5Lm9yZyIsCiAgICAiYWNiYWRnZXkudGVjaCIsCiAgICAiYWNiYWRnZXkudG9wIiwKICAgICJhY2JhZGdleS54eXoiLAogICAgImFjYmFkZ2V6LmNvbSIsCiAgICAiYWNiYWRnZXoubmV0IiwKICAgICJhY2JhZGdlei5vcmciLAogICAgImFjYmFkZ2V6LnRlY2giLAogICAgImFjYmFkZ2V6LnRvcCIsCiAgICAiYWNiYWRnZXoueHl6IiwKICAgICJhY2JhZGdmLmNvbSIsCiAgICAiYWNiYWRnZi5uZXQiLAogICAgImFjYmFkZ2Yub3JnIiwKICAgICJhY2JhZGdmLnRlY2giLAogICAgImFjYmFkZ2YudG9wIiwKICAgICJhY2JhZGdmLnh5eiIsCiAgICAiYWNiYWRnbS5jb20iLAogICAgImFjYmFkZ20ubmV0IiwKICAgICJhY2JhZGdtLm9yZyIsCiAgICAiYWNiYWRnbS50ZWNoIiwKICAgICJhY2JhZGdtLnRvcCIsCiAgICAiYWNiYWRnbS54eXoiLAogICAgImFjYmFkZ3IuY29tIiwKICAgICJhY2JhZGdyLm5ldCIsCiAgICAiYWNiYWRnci5vcmciLAogICAgImFjYmFkZ3IudGVjaCIsCiAgICAiYWNiYWRnci50b3AiLAogICAgImFjYmFkZ3IueHl6IiwKICAgICJhY2JhZGdzLmNvbSIsCiAgICAiYWNiYWRncy5uZXQiLAogICAgImFjYmFkZ3Mub3JnIiwKICAgICJhY2JhZGdzLnRlY2giLAogICAgImFjYmFkZ3MudG9wIiwKICAgICJhY2JhZGdzLnh5eiIsCiAgICAiYWNiYWRndC5jb20iLAogICAgImFjYmFkZ3QubmV0IiwKICAgICJhY2JhZGd0Lm9yZyIsCiAgICAiYWNiYWRndC50ZWNoIiwKICAgICJhY2JhZGd0LnRvcCIsCiAgICAiYWNiYWRndC54eXoiLAogICAgImFjYmFkZ3cuY29tIiwKICAgICJhY2JhZGd3Lm5ldCIsCiAgICAiYWNiYWRndy5vcmciLAogICAgImFjYmFkZ3cudGVjaCIsCiAgICAiYWNiYWRndy50b3AiLAogICAgImFjYmFkZ3cueHl6IiwKICAgICJhY2JhZGd5LmNvbSIsCiAgICAiYWNiYWRneS5uZXQiLAogICAgImFjYmFkZ3kub3JnIiwKICAgICJhY2JhZGd5LnRlY2giLAogICAgImFjYmFkZ3kudG9wIiwKICAgICJhY2JhZGd5Lnh5eiIsCiAgICAiYWNiYWRnei5jb20iLAogICAgImFjYmFkZ3oubmV0IiwKICAgICJhY2JhZGd6Lm9yZyIsCiAgICAiYWNiYWRnei50ZWNoIiwKICAgICJhY2JhZGd6LnRvcCIsCiAgICAiYWNiYWRnei54eXoiLAogICAgImFjYmFkdi5jb20iLAogICAgImFjYmFkdi5uZXQiLAogICAgImFjYmFkdi5vcmciLAogICAgImFjYmFkdi50ZWNoIiwKICAgICJhY2JhZHYudG9wIiwKICAgICJhY2JhZHYueHl6IiwKICAgICJhY2JhZHguY29tIiwKICAgICJhY2JhZHgubmV0IiwKICAgICJhY2JhZHgub3JnIiwKICAgICJhY2JhZHgudGVjaCIsCiAgICAiYWNiYWR4LnRvcCIsCiAgICAiYWNiYWR4Lnh5eiIsCiAgICAiYWNiYWR5LmNvbSIsCiAgICAiYWNiYWR5Lm5ldCIsCiAgICAiYWNiYWR5Lm9yZyIsCiAgICAiYWNiYWR5LnRlY2giLAogICAgImFjYmFkeS50b3AiLAogICAgImFjYmFkeS54eXoiLAogICAgImFjYmFkei5jb20iLAogICAgImFjYmFkei5uZXQiLAogICAgImFjYmFkei5vcmciLAogICAgImFjYmFkei50ZWNoIiwKICAgICJhY2JhZHoudG9wIiwKICAgICJhY2JhZHoueHl6IiwKICAgICJhY2JjbS5jb20iLAogICAgImFjYmNtLm5ldCIsCiAgICAiYWNiY20ub3JnIiwKICAgICJhY2JjbS50ZWNoIiwKICAgICJhY2JjbS50b3AiLAogICAgImFjYmNtLnh5eiIsCiAgICAiYWNiY3MuY29tIiwKICAgICJhY2Jjcy5uZXQiLAogICAgImFjYmNzLm9yZyIsCiAgICAiYWNiY3MudGVjaCIsCiAgICAiYWNiY3MudG9wIiwKICAgICJhY2Jjcy54eXoiLAogICAgImFjYmN4LmNvbSIsCiAgICAiYWNiY3gubmV0IiwKICAgICJhY2JjeC5vcmciLAogICAgImFjYmN4LnRlY2giLAogICAgImFjYmN4LnRvcCIsCiAgICAiYWNiY3gueHl6IiwKICAgICJhY2JjeS5jb20iLAogICAgImFjYmN5Lm5ldCIsCiAgICAiYWNiY3kub3JnIiwKICAgICJhY2JjeS50ZWNoIiwKICAgICJhY2JjeS50b3AiLAogICAgImFjYmN5Lnh5eiIsCiAgICAiYWNiY3ouY29tIiwKICAgICJhY2Jjei5uZXQiLAogICAgImFjYmN6Lm9yZyIsCiAgICAiYWNiY3oudGVjaCIsCiAgICAiYWNiY3oudG9wIiwKICAgICJhY2Jjei54eXoiLAogICAgImFjYmRtLmNvbSIsCiAgICAiYWNiZG0ubmV0IiwKICAgICJhY2JkbS5vcmciLAogICAgImFjYmRtLnRlY2giLAogICAgImFjYmRtLnRvcCIsCiAgICAiYWNiZG0ueHl6IiwKICAgICJhY2Jkcy5jb20iLAogICAgImFjYmRzLm5ldCIsCiAgICAiYWNiZHMub3JnIiwKICAgICJhY2Jkcy50ZWNoIiwKICAgICJhY2Jkcy50b3AiLAogICAgImFjYmRzLnh5eiIsCiAgICAiYWNiZHguY29tIiwKICAgICJhY2JkeC5uZXQiLAogICAgImFjYmR4Lm9yZyIsCiAgICAiYWNiZHgudGVjaCIsCiAgICAiYWNiZHgudG9wIiwKICAgICJhY2JkeC54eXoiLAogICAgImFjYmR5LmNvbSIsCiAgICAiYWNiZHkubmV0IiwKICAgICJhY2JkeS5vcmciLAogICAgImFjYmR5LnRlY2giXQ=='
class LocationPage(QWizardPage):
    def __init__(self, parent=None):
        super(LocationPage, self).__init__(parent)
        self.setTitle("Installation Location")
        self.setSubTitle("Choose where to install Dillusion Browser.")
        self.location_edit = QLineEdit()
        self.location_edit.setPlaceholderText("Enter installation path or leave blank for default")
        layout = QVBoxLayout()
        layout.addWidget(self.location_edit)
        self.setLayout(layout)

    def validatePage(self):
        location = self.location_edit.text()
        if location and not os.path.isdir(location):
            return False
        return True

class OptionsPage(QWizardPage):
    def __init__(self, parent=None):
        super(OptionsPage, self).__init__(parent)
        self.setTitle("Installation Options")
        self.setSubTitle("Choose additional options for the installation.")
        desktop_shortcut = QCheckBox("Create desktop shortcut")
        start_menu_shortcut = QCheckBox("Create start menu shortcut")
        layout = QVBoxLayout()
        options_group = QGroupBox("Options")
        options_layout = QVBoxLayout()
        options_layout.addWidget(desktop_shortcut)
        options_layout.addWidget(start_menu_shortcut)
        options_group.setLayout(options_layout)
        layout.addWidget(options_group)
        self.setLayout(layout)
# ... (rest of the code remains the same) ...
class IntroPage(QWizardPage):
    def __init__(self, parent=None):
        super(IntroPage, self).__init__(parent)
        self.setTitle("Welcome to the Dillusion Browser Installer")
        label = QLabel("This wizard will guide you through the installation process.")
        layout = QVBoxLayout()
        layout.addWidget(label)
        self.setLayout(layout)
class ConclusionPage(QWizardPage):
    def __init__(self, parent=None):
        super(ConclusionPage, self).__init__(parent)
        self.setTitle("Installation Complete")
        label = QLabel("Dillusion Browser has been installed successfully. ")
        layout = QVBoxLayout()
        layout.addWidget(label)
        self.setLayout(layout)

class InstallerWizard(QWizard):
    def __init__(self, parent=None):
        super(InstallerWizard, self).__init__(parent)
        self.addPage(IntroPage())
        self.addPage(LocationPage())
        self.addPage(OptionsPage())
        self.addPage(ConclusionPage())
        self.setWindowTitle("Dillusion Browser Installer")
        self.setWizardStyle(QWizard.ModernStyle)

    def accept(self):
        location = self.page(1).layout().itemAt(0).widget().text()
        if not location:
            location = os.path.join(os.path.expanduser("~"), "Dillusion Browser")
        options_page = self.page(2)

        # Create the installation directory if it doesn't exist
        os.makedirs(location, exist_ok=True)

        # Write the base64-encoded files to the installation directory
        with open(os.path.join(location, "main.py"), "wb") as f:
            f.write(base64.b64decode(MAIN_PY))
        with open(os.path.join(location, "ad_selectors.json"), "wb") as f:
            f.write(base64.b64decode(AD_SELECTORS_JSON))
        with open(os.path.join(location, "blocked_domains.json"), "wb") as f:
            f.write(base64.b64decode(BLOCKED_DOMAINS_JSON))
        # Create start menu shortcut
        run_sh_path = os.path.join(location, "run.sh")
        print('[WARN] Sudo needed')
        with open(run_sh_path, "w") as f:
            f.write(f"#!/bin/sh\npython3 {os.path.join(location, 'main.py')}")
        os.chmod(run_sh_path, 0o755)  # Make the script executable
        # Here, you could perform additional installation tasks based on the selected options
        print(f"Installing Dillusion Browser to: {location}")

        super().accept()

if __name__ == "__main__":
    app = QApplication(sys.argv)
    wizard = InstallerWizard()
    wizard.show()
    sys.exit(app.exec_())
